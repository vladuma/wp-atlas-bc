(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[471],{1763:function(e,t,o){var s=o(4239),r=o(7005);e.exports=function(e){return"number"==typeof e||r(e)&&"[object Number]"==s(e)}},471:function(e,t,o){"use strict";o.r(t),o.d(t,{OAuth:function(){return c}});o(4301);var s=o(4997),r=o(4293),n=o(7037),i=o(1763),a=o(2228);class c{cookies;tokenKey;constructor(e){this.cookies=e,this.tokenKey=`${(0,s.vc)().wpUrl}-rt`}getRefreshToken(){return this.cookies.getCookie(this.tokenKey)}setRefreshToken(e,t){n(e)&&0!==e.length||this.cookies.removeCookie(this.tokenKey);let o,s=2592e3;i(t)&&(o=new Date(1e3*t),s=void 0),this.cookies.setCookie(this.tokenKey,e,{expires:o,maxAge:s,path:"/",sameSite:"strict",secure:!0,httpOnly:!0})}async fetch(e){const{wpUrl:t,apiClientSecret:o}=(0,s.vc)();if(!o)throw new Error("The apiClientSecret must be specified to use the auth middleware");let r=await fetch(`${t}/?rest_route=/faustwp/v1/authorize`,{headers:{"Content-Type":"application/json","x-faustwp-secret":o},method:"POST",body:JSON.stringify({code:e,refreshToken:this.getRefreshToken()})});404===r.status&&(r=await fetch(`${t}/?rest_route=/wpac/v1/authorize`,{headers:{"Content-Type":"application/json","x-wpe-headless-secret":o},method:"POST",body:JSON.stringify({code:e,refreshToken:this.getRefreshToken()})}),404!==r.status&&(0,a.cM)("Authentication and post previews will soon be incompatible with your version of the FaustWP plugin. Please update to the latest version."));const n=await r.json();return r.ok?n:{error:!0,response:r,result:n}}isOAuthTokens(e){const t=e;return!r(t)&&n(t.accessToken)&&n(t.refreshToken)&&i(t.accessTokenExpiration)&&i(t.refreshTokenExpiration)}}}}]);