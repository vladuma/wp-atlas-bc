function createPrefetch(query, { scheduler }) {
  return function prefetch(fn) {
    const existingData = fn(query);
    if (scheduler.resolving) {
      return Object.assign(scheduler.resolving.promise.then(() => prefetch(fn)), {
        schedulerPromise: scheduler.resolving.promise
      });
    }
    return existingData;
  };
}

export { createPrefetch };
