import { isObject, get, set } from '../Utils/object.mjs';
import 'lodash/mergeWith.js';

function selectFields(accessor, fields = "*", recursionDepth = 1) {
  if (accessor == null)
    return accessor;
  if (Array.isArray(accessor)) {
    return accessor.map((value) => selectFields(value, fields, recursionDepth));
  }
  if (!isObject(accessor))
    return accessor;
  if (fields.length === 0) {
    return {};
  }
  if (typeof fields === "string") {
    if (recursionDepth > 0) {
      const allAccessorKeys = Object.keys(accessor);
      return allAccessorKeys.reduce((acum, fieldName) => {
        const fieldValue = get(accessor, fieldName);
        if (Array.isArray(fieldValue)) {
          set(acum, fieldName, fieldValue.map((value) => {
            return selectFields(value, "*", recursionDepth - 1);
          }));
        } else if (isObject(fieldValue)) {
          set(acum, fieldName, selectFields(fieldValue, "*", recursionDepth - 1));
        } else {
          set(acum, fieldName, fieldValue);
        }
        return acum;
      }, {});
    } else {
      return null;
    }
  }
  return fields.reduce((acum, fieldName) => {
    const fieldValue = get(accessor, fieldName);
    if (fieldValue === void 0)
      return acum;
    if (Array.isArray(fieldValue)) {
      set(acum, fieldName, fieldValue.map((value) => {
        return selectFields(value, "*", recursionDepth);
      }));
    } else if (isObject(fieldValue)) {
      set(acum, fieldName, selectFields(fieldValue, "*", recursionDepth));
    } else {
      set(acum, fieldName, fieldValue);
    }
    return acum;
  }, {});
}

export { selectFields };
