"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.apiRouter = void 0;
const isUndefined_js_1 = __importDefault(require("lodash/isUndefined.js"));
const middleware_js_1 = require("../auth/middleware.js");
const index_js_1 = require("../../utils/index.js");
const index_js_2 = require("../../config/index.js");
/**
 * A node handler for processing all incoming Faust.js API requests.
 *
 * @example ```ts
 * // filename: pages/api/faust/[[...route]].ts
 * import 'faust.config';
 * import { apiRouter } from '@faustjs/core/api';
 *
 * export default apiRouter;
 * ```
 *
 * @param {IncomingMessage} req
 * @param {ServerResponse} res
 */
async function apiRouter(req, res) {
    const { apiBasePath } = (0, index_js_2.config)();
    if ((0, isUndefined_js_1.default)(apiBasePath)) {
        throw new Error(`You must provide an apiBasePath value in your config in order to use the API router`);
    }
    const parsedUrl = (0, index_js_1.parseUrl)(req.url);
    const pathname = parsedUrl === null || parsedUrl === void 0 ? void 0 : parsedUrl.pathname;
    switch (pathname) {
        case `${apiBasePath}/${index_js_2.TOKEN_ENDPOINT_PARTIAL_PATH}`:
            return (0, middleware_js_1.authorizeHandler)(req, res);
        case `${apiBasePath}/${index_js_2.LOGOUT_ENDPOINT_PARTIAL_PATH}`:
            return (0, middleware_js_1.logoutHandler)(req, res);
        default:
            res.statusCode = 404;
            res.end();
    }
}
exports.apiRouter = apiRouter;
