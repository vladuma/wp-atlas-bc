// eslint-disable-next-line import/extensions
import { PostIdType } from '@faustjs/core/client';
import { useRouter } from 'next/router.js';
import defaults from 'lodash/defaults.js';
import isString from 'lodash/isString.js';
import { hasPostId, hasPostSlug, hasPostUri } from '../../utils/index.js';
export function create(useQuery) {
    return (args) => {
        const router = useRouter();
        const { post } = useQuery();
        let params = defaults({}, args);
        const { query } = router;
        if (hasPostId(query)) {
            params = {
                id: query.postId,
                idType: PostIdType.ID,
                ...params,
            };
        }
        else if (hasPostSlug(query)) {
            params = {
                id: query.postSlug,
                idType: PostIdType.SLUG,
                ...params,
            };
        }
        else if (hasPostUri(query)) {
            params = {
                id: query.postUri.join('/'),
                idType: PostIdType.URI,
                ...params,
            };
        }
        if (!isString(params.id)) {
            throw new Error('Invalid parameters for usePost, you must send in an id or specify known URL params in your config');
        }
        return post(params);
    };
}
