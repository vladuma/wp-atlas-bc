{"version":3,"file":"createAxiosFetcher.js","mappings":"CAAA,SAA2CA,EAAMC,GAC1B,iBAAZC,SAA0C,iBAAXC,OACxCA,OAAOD,QAAUD,IACQ,mBAAXG,QAAyBA,OAAOC,IAC9CD,OAAO,GAAIH,GACe,iBAAZC,QACdA,QAAkB,SAAID,KAEtBD,EAAe,SAAIA,EAAe,UAAK,GAAIA,EAAe,SAAsB,mBAAIC,KARtF,CASGK,MAAM,WACT,M,mLCRA,kBAEA,MAAqBC,UAAmB,UAKtCC,YAAYC,EAA6BC,EAAmBC,EAAgBC,GAC1EC,MAAMD,GACNE,OAAOC,eAAeC,KAAMT,EAAWU,WACvCD,KAAKE,KAAO,aACZF,KAAKP,SAAWA,EAChBO,KAAKN,QAAUA,EACfM,KAAKL,KAAOA,GAXhB,a,6DCJA,MAAqBQ,UAAsBC,MACzCZ,YAAYI,GACVC,MAAMD,GACNE,OAAOC,eAAeC,KAAMG,EAAcF,WAC1CD,KAAKE,KAAO,iBAJhB,a,qdCEA,kBACA,SA2FA,UAzF2CG,IACzC,IAAIC,EAGFA,EADEC,WAAWC,MACLD,WAAWC,MAGX,eAGV,MAAMA,EAAuBF,EAAMG,OAAO,CACxCC,QAASL,EAAeM,KACxBC,QAAS,CAAE,eAAgB,oBAC3BC,iBAAmBC,IAAW,IAAAC,qBAAoBD,KAGpD,MAAO,CACLE,MAAcC,GAAiB,OAAD,6BAC5B,IACE,MAAM,IAAEC,EAAG,OAAEJ,EAAM,OAAEK,EAAM,QAAEP,EAAO,gBAAEQ,GAAoBH,EAC1D,IAAII,EAaAC,EAXJ,OAAQH,EAAOI,eACb,IAAK,MACL,IAAK,OACL,IAAK,SACL,IAAK,QACHF,EAAU,CAAE1B,KAAMmB,GAClB,MACF,QACEO,EAAU,CAAEP,OAAAA,GAKhB,MAAMU,GAAY,EAElB,OAAQJ,GACN,IAAK,OACL,IAAK,OACHE,EAAeF,EACf,MACF,IAAK,SACHE,EAAeE,EAAY,OAAS,SACpC,MACF,QACEF,OAAeG,EAGnB,MAAMhC,QAAiBe,EAAM,OAAD,QAC1BU,IAAAA,EACAC,OAAQA,EAAOI,cACfX,QAAAA,EACAU,aAAAA,GACGD,IAGL,MAAwB,WAApBD,GAAgCI,EAC3B,CAAE7B,KAAMF,EAASE,KAAK+B,UAGxB,CAAE/B,KAAMF,EAASE,MACxB,MAAOgC,GACP,GAAIrB,EAAMsB,aAAaD,GAAQ,CAC7B,MAAM,SAAElC,GAAakC,EAErB,IAAKlC,EACH,MAAM,IAAI,UAAW,KAAMkC,EAAMjC,QAAS,KAAMiC,EAAM/B,SAGxD,MAAMiC,EAAkB,OAAH,UAAQpC,GAU7B,MAPAK,OAAOgC,iBAAiBD,EAAiB,CACvCE,OAAQ,CAAEC,YAAY,GACtBrC,KAAM,CAAEqC,YAAY,GACpBpB,QAAS,CAAEoB,YAAY,GACvBtC,QAAS,CAAEsC,YAAY,KAGnB,IAAI,UAAWH,EAAiBF,EAAMjC,QAASmC,EAAgBlC,KAAMgC,EAAM/B,SAGnF,MAAM,IAAI,UAAW,KAAM,KAAM,KAAM+B,EAAM/B,gB,0FCtFrD,MAiBMqC,EAAW,MACf,MAAMC,EAAQ,GAEd,IAAK,IAAIC,EAAI,EAAGA,EAAI,MAAOA,EACzBD,EAAME,KAAK,MAAQD,EAAI,GAAK,IAAM,IAAMA,EAAEE,SAAS,KAAKd,eAG1D,OAAOW,GAPQ,GAUXI,EAAS,CAACC,EAAKC,KAGnB,GAAmB,IAAfD,EAAIE,OACN,OAAOF,EAGT,IAAIG,EAASH,EAOb,GANmB,iBAARA,EACTG,EAASC,OAAO1C,UAAUoC,SAASO,KAAKL,GAChB,iBAARA,IAChBG,EAASG,OAAON,IAGF,eAAZC,EACF,OAAOM,OAAOJ,GAAQK,QAAQ,mBAAmB,SAAUC,GACzD,MAAO,SAAWC,SAASD,EAAGE,MAAM,GAAI,IAAM,SAIlD,IAAIC,EAAM,GACV,IAAK,IAAIhB,EAAI,EAAGA,EAAIO,EAAOD,SAAUN,EAAG,CACtC,IAAIiB,EAAIV,EAAOW,WAAWlB,GAGlB,KAANiB,GACM,KAANA,GACM,KAANA,GACM,MAANA,GACCA,GAAK,IAAQA,GAAK,IAClBA,GAAK,IAAQA,GAAK,IAClBA,GAAK,IAAQA,GAAK,IAEnBD,GAAOT,EAAOY,OAAOnB,GAInBiB,EAAI,IACND,GAAYlB,EAASmB,GAInBA,EAAI,KACND,GAAalB,EAAS,IAAQmB,GAAK,GAAMnB,EAAS,IAAY,GAAJmB,GAIxDA,EAAI,OAAUA,GAAK,MACrBD,GAAalB,EAAS,IAAQmB,GAAK,IAAOnB,EAAS,IAASmB,GAAK,EAAK,IAASnB,EAAS,IAAY,GAAJmB,IAIlGjB,GAAK,EACLiB,EAAI,QAAiB,KAAJA,IAAc,GAA8B,KAAvBV,EAAOW,WAAWlB,IACxDgB,GACElB,EAAS,IAAQmB,GAAK,IACtBnB,EAAS,IAASmB,GAAK,GAAM,IAC7BnB,EAAS,IAASmB,GAAK,EAAK,IAC5BnB,EAAS,IAAY,GAAJmB,IAGrB,OAAOD,GAGHI,EAAUC,MAAMD,QAEhBnB,EAAOoB,MAAMvD,UAAUmC,KAEvBqB,EAAc,CAACC,EAAKC,KACxBvB,EAAKwB,MAAMF,EAAKH,EAAQI,GAAgBA,EAAe,CAACA,KAGpDE,EAAoBC,GACjBjB,OAAOiB,GAGVC,EAA8B,CAACC,EAAgBC,IAAyBD,EAAS,KAEjFxB,EAAU,QAEV0B,EAAY,CAACC,EAAiBH,KA3Gd,IAEJI,EAQaC,EA0G7B,GARIF,aAAkBG,OACpBH,EAAuBA,EA7GgBI,eAgH1B,OAAXJ,IACFA,EAAS,IAtGE,iBADgBE,EA0GHF,IAxGb,iBAANE,GACM,kBAANA,GACM,iBAANA,GACM,iBAANA,IAbSD,EAkH8BD,IAjHnB,iBAARC,GAITA,EAAI5E,aAAe4E,EAAI5E,YAAYgF,UAAYJ,EAAI5E,YAAYgF,SAASJ,GA6G3B,CACrD,MAAMK,EAAWnC,EAAO0B,EAAQxB,GAEhC,MAAO,CAACqB,EAAiBY,GAAY,IAAMZ,EAAiBvB,EAAO6B,EAAQ3B,KAG7E,MAAMkC,EAAS,GAEf,QAAsB,IAAXP,EACT,OAAOO,EAGT,MAAMC,EAAU7E,OAAO8E,KAAKT,GAE5B,IAAK,IAAIhC,EAAI,EAAGA,EAAIwC,EAAQlC,SAAUN,EAAG,CACvC,MAAM0C,EAAMF,EAAQxC,GACd2B,EAAQK,EAAOU,GAEfC,EAAYvB,EAAQY,GAAUJ,EAA4BC,GAAeA,EAAU,IAAMa,EAAM,IAErGpB,EAAYiB,EAAQR,EAAUJ,EAAOgB,IAGvC,OAAOJ,GAsBA,EAAA3D,oBAdoBoD,IAC3B,MAAMY,EAAe,GAEfJ,EAAU7E,OAAO8E,KAAKT,GAE5B,IAAK,IAAIhC,EAAI,EAAGA,EAAIwC,EAAQlC,SAAUN,EAAG,CACvC,MAAM0C,EAAMF,EAAQxC,GAEpBsB,EAAYsB,EAAcb,EAAUC,EAAOU,GAAMA,IAGnD,OAAOE,EAAaC,KAAK,O,QChK3B7F,EAAOD,QAAU+F,QAAQ,WCCrBC,EAA2B,G,OAG/B,SAASC,EAAoBC,GAE5B,IAAIC,EAAeH,EAAyBE,GAC5C,QAAqB3D,IAAjB4D,EACH,OAAOA,EAAanG,QAGrB,IAAIC,EAAS+F,EAAyBE,GAAY,CAGjDlG,QAAS,IAOV,OAHAoG,EAAoBF,GAAUxC,KAAKzD,EAAOD,QAASC,EAAQA,EAAOD,QAASiG,GAGpEhG,EAAOD,QClBWiG,CAAoB,M","sources":["webpack://@spree/storefront-api-v2-sdk/webpack/universalModuleDefinition","webpack://@spree/storefront-api-v2-sdk/./src/errors/FetchError.ts","webpack://@spree/storefront-api-v2-sdk/./src/errors/SpreeSDKError.ts","webpack://@spree/storefront-api-v2-sdk/./src/fetchers/createAxiosFetcher.ts","webpack://@spree/storefront-api-v2-sdk/./src/helpers/request.ts","webpack://@spree/storefront-api-v2-sdk/external commonjs \"axios\"","webpack://@spree/storefront-api-v2-sdk/webpack/bootstrap","webpack://@spree/storefront-api-v2-sdk/webpack/startup"],"sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"SpreeSDK\"] = factory();\n\telse\n\t\troot[\"SpreeSDK\"] = root[\"SpreeSDK\"] || {}, root[\"SpreeSDK\"][\"createAxiosFetcher\"] = factory();\n})(self, function() {\nreturn ","import type { RawFetchRequest } from '../interfaces/RawFetchRequest'\nimport type { RawFetchResponse } from '../interfaces/RawFetchResponse'\nimport SpreeSDKError from './SpreeSDKError'\n\nexport default class FetchError extends SpreeSDKError {\n  public response?: RawFetchResponse\n  public request?: RawFetchRequest\n  public data?: any\n\n  constructor(response?: RawFetchResponse, request?: unknown, data?: unknown, message?: string) {\n    super(message)\n    Object.setPrototypeOf(this, FetchError.prototype)\n    this.name = 'FetchError'\n    this.response = response\n    this.request = request\n    this.data = data\n  }\n}\n","export default class SpreeSDKError extends Error {\n  constructor(message: string) {\n    super(message)\n    Object.setPrototypeOf(this, SpreeSDKError.prototype)\n    this.name = 'SpreeSDKError'\n  }\n}\n","import type { AxiosInstance } from 'axios'\nimport type { CreateFetcher } from '../interfaces/ClientConfig'\nimport FetchError from '../errors/FetchError'\nimport { objectToQuerystring } from '../helpers/request'\n\nconst createAxiosFetcher: CreateFetcher = (fetcherOptions) => {\n  let Axios\n\n  if (globalThis.axios) {\n    Axios = globalThis.axios\n  } else {\n    // eslint-disable-next-line @typescript-eslint/no-var-requires\n    Axios = require('axios').default\n  }\n\n  const axios: AxiosInstance = Axios.create({\n    baseURL: fetcherOptions.host,\n    headers: { 'Content-Type': 'application/json' },\n    paramsSerializer: (params) => objectToQuerystring(params)\n  })\n\n  return {\n    fetch: async (fetchOptions) => {\n      try {\n        const { url, params, method, headers, responseParsing } = fetchOptions\n        let payload\n\n        switch (method.toUpperCase()) {\n          case 'PUT':\n          case 'POST':\n          case 'DELETE':\n          case 'PATCH':\n            payload = { data: params }\n            break\n          default:\n            payload = { params }\n        }\n\n        let responseType: string\n\n        const isBrowser = RUNTIME_TYPE === 'browser'\n\n        switch (responseParsing) {\n          case 'json':\n          case 'text':\n            responseType = responseParsing\n            break\n          case 'stream':\n            responseType = isBrowser ? 'blob' : 'stream'\n            break\n          default:\n            responseType = undefined\n        }\n\n        const response = await axios({\n          url,\n          method: method.toUpperCase(),\n          headers,\n          responseType,\n          ...payload\n        })\n\n        if (responseParsing === 'stream' && isBrowser) {\n          return { data: response.data.stream() }\n        }\n\n        return { data: response.data }\n      } catch (error) {\n        if (Axios.isAxiosError(error)) {\n          const { response } = error\n\n          if (!response) {\n            throw new FetchError(null, error.request, null, error.message)\n          }\n\n          const reducedResponse = { ...response }\n\n          // Reduce logging by removing the 'enumerable' flag on some keys in AxiosResponse.\n          Object.defineProperties(reducedResponse, {\n            config: { enumerable: false },\n            data: { enumerable: false },\n            headers: { enumerable: false },\n            request: { enumerable: false }\n          })\n\n          throw new FetchError(reducedResponse, error.request, reducedResponse.data, error.message)\n        }\n\n        throw new FetchError(null, null, null, error.message)\n      }\n    }\n  }\n}\n\nexport default createAxiosFetcher\n","// Based on https://github.com/ljharb/qs/blob/master/lib/stringify.js\n\nconst serializeDate = (date: Date) => date.toISOString()\n\nconst isBuffer = (obj) => {\n  if (!obj || typeof obj !== 'object') {\n    return false\n  }\n\n  return !!(obj.constructor && obj.constructor.isBuffer && obj.constructor.isBuffer(obj))\n}\n\nconst isNonNullishPrimitive = (v) =>\n  typeof v === 'string' ||\n  typeof v === 'number' ||\n  typeof v === 'boolean' ||\n  typeof v === 'symbol' ||\n  typeof v === 'bigint'\n\nconst hexTable = (() => {\n  const array = []\n\n  for (let i = 0; i < 256; ++i) {\n    array.push('%' + ((i < 16 ? '0' : '') + i.toString(16)).toUpperCase())\n  }\n\n  return array\n})()\n\nconst encode = (str, charset): string => {\n  // This code was originally written by Brian White (mscdex) for the io.js core querystring library.\n  // It has been adapted here for stricter adherence to RFC 3986\n  if (str.length === 0) {\n    return str\n  }\n\n  let string = str\n  if (typeof str === 'symbol') {\n    string = Symbol.prototype.toString.call(str)\n  } else if (typeof str !== 'string') {\n    string = String(str)\n  }\n\n  if (charset === 'iso-8859-1') {\n    return escape(string).replace(/%u[0-9a-f]{4}/gi, function ($0) {\n      return '%26%23' + parseInt($0.slice(2), 16) + '%3B'\n    })\n  }\n\n  let out = ''\n  for (let i = 0; i < string.length; ++i) {\n    let c = string.charCodeAt(i)\n\n    if (\n      c === 0x2d || // -\n      c === 0x2e || // .\n      c === 0x5f || // _\n      c === 0x7e || // ~\n      (c >= 0x30 && c <= 0x39) || // 0-9\n      (c >= 0x41 && c <= 0x5a) || // a-z\n      (c >= 0x61 && c <= 0x7a) // A-Z\n    ) {\n      out += string.charAt(i)\n      continue\n    }\n\n    if (c < 0x80) {\n      out = out + hexTable[c]\n      continue\n    }\n\n    if (c < 0x800) {\n      out = out + (hexTable[0xc0 | (c >> 6)] + hexTable[0x80 | (c & 0x3f)])\n      continue\n    }\n\n    if (c < 0xd800 || c >= 0xe000) {\n      out = out + (hexTable[0xe0 | (c >> 12)] + hexTable[0x80 | ((c >> 6) & 0x3f)] + hexTable[0x80 | (c & 0x3f)])\n      continue\n    }\n\n    i += 1\n    c = 0x10000 + (((c & 0x3ff) << 10) | (string.charCodeAt(i) & 0x3ff))\n    out +=\n      hexTable[0xf0 | (c >> 18)] +\n      hexTable[0x80 | ((c >> 12) & 0x3f)] +\n      hexTable[0x80 | ((c >> 6) & 0x3f)] +\n      hexTable[0x80 | (c & 0x3f)]\n  }\n\n  return out\n}\n\nconst isArray = Array.isArray\n\nconst push = Array.prototype.push\n\nconst pushToArray = (arr, valueOrArray) => {\n  push.apply(arr, isArray(valueOrArray) ? valueOrArray : [valueOrArray])\n}\n\nconst rfc3986Formatter = (value): string => {\n  return String(value)\n}\n\nconst generateBracketsArrayPrefix = (prefix: string, _key: string): string => prefix + '[]'\n\nconst charset = 'utf-8'\n\nconst stringify = (source: unknown, prefix: string) => {\n  if (source instanceof Date) {\n    source = serializeDate(source)\n  }\n\n  if (source === null) {\n    source = ''\n  }\n\n  if (isNonNullishPrimitive(source) || isBuffer(source)) {\n    const keyValue = encode(prefix, charset)\n\n    return [rfc3986Formatter(keyValue) + '=' + rfc3986Formatter(encode(source, charset))]\n  }\n\n  const values = []\n\n  if (typeof source === 'undefined') {\n    return values\n  }\n\n  const objKeys = Object.keys(source)\n\n  for (let i = 0; i < objKeys.length; ++i) {\n    const key = objKeys[i]\n    const value = source[key]\n\n    const keyPrefix = isArray(source) ? generateBracketsArrayPrefix(prefix, key) : prefix + ('[' + key + ']')\n\n    pushToArray(values, stringify(value, keyPrefix))\n  }\n\n  return values\n}\n\n/**\n * Serializes object into a query string understood by Spree.\n * Spree uses the \"brackets\" format for serializing arrays which\n * is a different format than used by URLSearchParams.\n */\nconst objectToQuerystring = (source: Record<string, any>): string => {\n  const topLevelKeys = []\n\n  const objKeys = Object.keys(source)\n\n  for (let i = 0; i < objKeys.length; ++i) {\n    const key = objKeys[i]\n\n    pushToArray(topLevelKeys, stringify(source[key], key))\n  }\n\n  return topLevelKeys.join('&')\n}\n\nexport { objectToQuerystring }\n","module.exports = require(\"axios\");","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// startup\n// Load entry module and return exports\n// This entry module is referenced by other modules so it can't be inlined\nvar __webpack_exports__ = __webpack_require__(596);\n"],"names":["root","factory","exports","module","define","amd","self","FetchError","constructor","response","request","data","message","super","Object","setPrototypeOf","this","prototype","name","SpreeSDKError","Error","fetcherOptions","Axios","globalThis","axios","create","baseURL","host","headers","paramsSerializer","params","objectToQuerystring","fetch","fetchOptions","url","method","responseParsing","payload","responseType","toUpperCase","isBrowser","undefined","stream","error","isAxiosError","reducedResponse","defineProperties","config","enumerable","hexTable","array","i","push","toString","encode","str","charset","length","string","Symbol","call","String","escape","replace","$0","parseInt","slice","out","c","charCodeAt","charAt","isArray","Array","pushToArray","arr","valueOrArray","apply","rfc3986Formatter","value","generateBracketsArrayPrefix","prefix","_key","stringify","source","obj","v","Date","toISOString","isBuffer","keyValue","values","objKeys","keys","key","keyPrefix","topLevelKeys","join","require","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__"],"sourceRoot":""}