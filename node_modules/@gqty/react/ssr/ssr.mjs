import * as React from 'react';
import { useOnFirstMount } from '../common.mjs';
import { getDefault } from '../utils.mjs';

function createSSRHelpers(client, { defaults: { refetchAfterHydrate } }) {
  const prepareReactRender = async function prepareReactRender2(element) {
    const ssrPrepass = getDefault(await import('react-ssr-prepass'));
    return client.prepareRender(() => ssrPrepass(element));
  };
  const useHydrateCache = function useHydrateCache2({
    cacheSnapshot,
    shouldRefetch = refetchAfterHydrate
  }) {
    useOnFirstMount(() => {
      if (cacheSnapshot) {
        client.hydrateCache({ cacheSnapshot, shouldRefetch: false });
      }
    });
    React.useEffect(() => {
      if (shouldRefetch) {
        client.refetch(client.query).catch(console.error);
      }
    }, [shouldRefetch]);
  };
  return {
    useHydrateCache,
    prepareReactRender
  };
}

export { createSSRHelpers };
